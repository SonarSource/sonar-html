name: Promote
on:
  workflow_run:
    workflows: [QA]
    types: [completed]
    branches:
      - master
      - branch-*
      - dogfood-*
  workflow_dispatch:

jobs:
  promote:
    name: Promote artifacts
    if: |
      github.event_name == 'workflow_dispatch' ||
      (github.event.workflow_run.conclusion == 'success' &&
       github.actor != 'dependabot[bot]' &&
       github.event.workflow_run.event != 'merge_group' &&
       (github.event.workflow_run.head_branch == 'master' ||
        startsWith(github.event.workflow_run.head_branch, 'branch-') ||
        startsWith(github.event.workflow_run.head_branch, 'dogfood-') ||
        github.event.workflow_run.event == 'pull_request'))
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: write
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 0
      - uses: jdx/mise-action@f8dfbcc150159126838e44b882bf34bd98fd90f3 # v2025.1.3
        with:
          version: 2025.1.3
      - uses: SonarSource/ci-github-actions/promote@v1
